# 웹 브라우저가 메시지를 만든다   
   
[1. HTTP 리퀘스트 메시지를 작성한다](#1-http-리퀘스트-메시지를-작성한다)   
[2. 웹 서버의 IP 주소를 DNS 서버에 조회한다](#2-웹-서버의-ip-주소를-dns-서버에-조회한다)   
[3. 전 세계의 DNS 서버가 연대한다](#3-전-세계의-dns-서버가-연대한다)   
[4. 프로토콜 스택에 메시지 송신을 의한다](#4-프로토콜-스택에-메시지-송신을-의뢰한다)   

  ## 1 HTTP 리퀘스트 메시지를 작성한다  

    1. 탐험 여행은 URL 입력부터 시작한다    

URL은 http 뿐만 아니라 ftp, file, mailto 등 여러 가지가 있다.   
도메인명은 www.cyber.co.kr 같이 마침표(.)로 구분하여 표현하는 이름   
프로토콜 : 통신 동작의 규칙, HTTP(HyperText Transfer Protocol)도 그 중 하나

    2. 브라우저는 먼저 URL을 해독한다   
    
http: + // + 웹 서버명 + 경로명( / + 디렉토리명 + / ... + 파일명)

    3. 파일명을 생략한 경우   
    
서버가 미리 설정해 둔 index.html or default.htm 등에 액세스

    4. HTTP의 기본 개념   
    
URL을 해독하면 어디에 액세스해야 하는지 판명난다. 그러고 나면 브라우저는 HTTP 프로토콜을 사용하여 웹 서버에 액세스.   
먼저 클라이언트에서 서버를 향해 리퀘스트 메시지를 보낸다. ( 무엇을, 어떻게 해서) 하겠다는 내용이 쓰여 있다.   
   
'무엇을'에 해당하는 것이 URI(Uniform Resource Identifier)인데 보통 데이터를 저장한 파일의 이름이나 CGI 프로그램 파일명이다.   
혹은 http:로 시작하면 URL을 그대로 쓸 수도 있다.   
   
'어떻게 해서'에 해당하는 것이 '메소드'로, 어떤 동작을 하고 싶은지를 전달한다.   
GET, POST, PUT, DELETE 등이 있다. 하지만 대부분 쓰이는 것은 GET과 POST

리퀘스트 메시지는 웹서버에 도착하면 내용을 해독한 후 결과 데이터를 응답 메시지에 저장한다.   
응답 메시지의 앞부분에는 404 Not Found 같은 status code가 있다.   
그 후 헤더 파일과 페이지의 데이터가 이어지고, 이 응답 메시지를 클라이언트에 반송한다.   
클라이언트에서 브라우저는 받은 메시지에서 데이터를 추출하여 화면에 표시하며 HTTP의 동작은 끝.

    5. HTTP 리퀘스트 메시지를 만든다.
   
다시 돌아가서 브라우저는 URL을 해독하고 웹 서버와 파일명을 판단하면 이것을 바탕으로 HTTP 리퀘스트 메시지를 만든다.   
포맷은 결정되어 있으므로 브라우저는 이 포맷에 맞게 만든다.   
   
먼저 첫 번째 행은 / 리퀘스트 라인 ( 메소드, URI, HTTP 버전 )
다음 부분은 한 행의 한 개의 / 메시지 헤더 ( 필드명 : 필드값, ... )   
마지막은 POST 방식일 때 / 메시지 본문 ( 서버에 보내는 데이터 )   
   

    6. 리퀘스트 메시지를 보내면 응답이 되돌아온다
    
응답 메시지는 리퀘스트 메시지와 첫 번째 행만 다르다.   
스테이터스 라인 ( HTTP 버전, status code, 응답 문구 )   
마지막의 데이터 부분을 추출한 후 화면에 표시하여 웹 페이지를 눈으로 볼 수 있다.   
페이지가 문장으로만 되어 있으면 끝. 영상 등이 포함되어 있으면 계속 이어진다.   
   
리퀘스트 메시지의 URI는 한 개로 결정되어 있으므로 파일을 한 번에 한 개씩만 읽을 수 있다.   
그러므로 응답 메시지에 영상 파일 태그가 포함되어 있으면 그것을 요청하는 리퀘스트 메시지를 만들어 보낸다.   
즉, 한 문장에 3개의 영상이 포함되어 있다면 문장 파일을 읽는 리퀘스트와 영상 파일을 읽는 리퀘스트 3개로   
총 4회 리퀘스트르 메시지를 서버에 보내게 된다.   
   
  ## 2 웹 서버의 IP 주소를 DNS 서버에 조회한다
  
    1. IP 주소의 기본   
    
HTTP 메시지를 만들면 OS에게 네트워크 송출을 의뢰하는데, 이 과정에서 도메인명을 IP 주소로 변환해야 한다.   
IP 주소는 TCP/IP의 개념에 기초하여 만들어졌다.   
   
TCP/IP와 IP주소의 기본 개념 : 액세스 대상의 서버까지 메시지를 운반할 때는,   
송신측 -> 메시지 (허브가 운반) -> 가장 가까운 라우터 -> 메시지를 확인해 다음 라우터를 판단하고 송신 -> 다음 라우터 -> ... -> 도착   
   
서브넷 = 몇 대의 PC가 허브에 접속해 있는 작은 네트워크   
전체 네트워크 = 라우터로 연결된 서브넷들의 집합   
   
IP 주소 : 00동 00번지 -> 네트워크 번호 : 00동, 호스트 번호 : 00번지   
   IP 주소는 32비트, 8비트씩 점으로 구분하여 10진수로 표기 ex) 10.11.12.13   
      
   IP 주소만으로는 무엇이 네트워크 번호이고 호스트 번호인지 알 수 없으므로 '넷마스크'를 덧붙여 식별   
   ex) 10.11.12.13/255.255.255.0   
       ㄴㅡIP 주소    ㄴㅡ넷마스크   
          
   네트워크 번호의 비트 수로 넷마스크를 표기하는 방법   
   ex ) 10.11.12.13/24   
        ㄴㅡIP 주소    ㄴㅡ 넷마스크   
           
   호스트 번호 부분의 비트가 모두 0인 것은 각 컴퓨터가 아니라 서브넷 자체를 나타냄 ex) 10.11.12.0/24    
   호스트 번호 부분의 비트가 모두 1인 것은 서브넷 전체에 대한 브로드캐스트를 나타냄 ex) 10.11.12.255/24   

    2. 도메인명과 IP 주소를 구분하여 사용하는 이유
IP 주소는 구분하기 어렵고, 도메인명을 주소로 사용하기에는 용량이 너무 커서 비효율적   

    3. Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다
Socket 라이브러리는 OS의 네트워크 기능을 애플리케이션에서 호출하기 위한 모음집   
그 중 DNS 서버를 조회하는 DNS 리졸버도 포함

    4. 리졸버를 이용하여 DNS 서버를 조회한다
도메인명에서 IP 주소를 조사할 때 브라우저는 Socket 라이브러리의 리졸버를 이용한다.

    5. 리졸버 내부의 작동
브라우저 -> Socket 리졸버 ( DNS 조회 메시지 만들고 송신 ) -> OS 내부 프로토콜 스택 -> DNS 서버 -> 역순으로 진행 -> 브라우저 메시지 수신
   
   ## 3 전 세계의 DNS 서버가 연대한다   
      1. DNS 서버의 기본 동작
   클라이언트는 DNS 서버에 조회 메시지를 보낸다. 조회 메시지에는 이름, 클래스(현재는 항상 'IN'), 타입(A(adress), MX(mail exchange) 등)   
   
      2. 도메인의 계층
   DNS 서버에 등록된 정보는 도메인명 이라는 계층적 구조를 가진 이름이 붙어 있다.   
   www.lab.cyber.co.kr 에서 .으로 구분된 lab부터 kr 까지 4개의 도메인과 www라는 하나의 이름으로 구성
     
      3. 담당 DNS 서버를 찾아 IP 주소를 가져온다
   최상위 도메인은 루트 도메인이고 보통 쓰이지 않지만 co.kr.-> 처럼 주소 마지막 .의 형태로 숨겨져 있다.   
   www.glasscom.com 이라는 서버를 찾아가는 경로는 아래와 같다.   
      
   _**클라이언트**_ (조회 메시지) ->    
   가장 가까운 DNS 서버(이하 가까운 DNS) -> 루트 도메인 -> 가까운 DNS (com 도메인의 DNS 서버 주소 응답) ->   
                                                         -> com 도메인 -> 가까운 DNS (glasscom 도메인의 DNS 서버 주소 응답) ->   
                                                         -> glasscom 도메인 -> 가까운 DNS (lab 도메인의 DNS 서버 주소 응답) ->   
                                                         -> lab 도메인 -> 가까운 DNS (www의 IP 주소) ->   
                                                         -> _**클라이언트**_
   
      4. DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다
   DNS 서버는 한 번 조사한 이름을 캐시에 기록   
   조회한 이름이 도메인에 등록되어 있지 않은 경우에는 이름이 존재하지 않는다는 회답을 캐시에 보존   
   캐시에 등록된 후 정보가 변경될 수도 있어 유효 기한을 설정해 주기적으로 삭제하는 것이 적절
      
   
   ## 4 프로토콜 스택에 메시지 송신을 의뢰한다
      1. 데이터 송∙수신 동작의 개요
   데이터 송∙수신은 네 단계로 동작한다.   
      
   1) 소켓 만들기   
   2) 서버 측 소켓에 파이프 연결   
   3) 데이터 송 수신   
   4) 파이프 분리, 소켓 말소   
   
   위 단계에 따라 OS 내부 프로토콜 스택에 메시지 송신 동작을 의뢰할 때는   
   Socket 라이브러리 프로그램 부품들을 순서대로 호출한다.   
      
      2. 소켓의 작성 단계
   Socket 라이브러리의 socket 프로그램 부품을 호출   
   소켓을 식별하기 위한 디스크립터 생성
      
      3. 파이프를 연결하는 접속 단계   
   Socket 라이브러리의 connect 프로그램 부품을 호출   
   포트 번호를 통해 서버 쪽에 이미 만들어진 소켓 식별   
   디스크립터, 서버의 IP 주소, 포트 번호 사용해 소켓끼리 연결, 데이터 송수신 준비 완료   
      
      4. 메시지를 주고받는 송∙수신 단계
   Socket 라이브러리의 write 프로그램 부품을 호출     
   애플리케이션은 송신 데이터(HTTP 리퀘스트 메시지)를 메모리에 준비   
   프로토콜 스택이 송신데이터를 서버에 송신   
   서버에서 응답 메시지 반송

      5. 연결 끊기 단계에서 송∙수신이 종료된다
   응답 메시지 송신을 완료하면 웹서버 측에서 close 호출, 연결을 끊고 클라이언트에 이 사실 전달   
   read는 데이터 대신 서버 측의 close 사실을 브라우저에게 전달
   Socket 라이브러리의 close 프로그램 부품을 호출, 연결       
   
   
   
   
