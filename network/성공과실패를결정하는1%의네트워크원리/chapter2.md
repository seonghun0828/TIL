# TCP/IP의 데이터를 전기 신호로 만들어 보낸다

[1. 소켓을 작성한다](#1-소켓을-작성한다)   
[2. 서버에 접속한다](#2-서버에-접속한다)   
[3. 데이터를 송∙수신한다](#3-데이터를-송수신한다)   
[4. 서버에서 연결을 끊어 소켓을 말소한다](#4-서버에서-연결을-끊어-소켓을-말소한다)   
[5. IP와 이더넷의 패킷 송∙수신 동작](#5-ip와-이더넷의-패킷-송수신-동작)   
[6. UDP 프로토콜을 이용한 송∙수신 동작](#6-udp-프로토콜을-이용한-송수신-동작)   

## 1 소켓을 작성한다
    1. 프로토콜 스택의 내부 구성
프로토콜 스택은 TCP, UDP, IP로 이뤄진다.   
TCP : 일반 애플리케이션 데이터 송수신   
UDP : DNS 서버 조회 등 짧은 제어용 데이터 송수신   
IP : 패킷으로 데이터를 나눠 이것을 통신 상대까지 운반   

    2. 소켓의 실체는 통신 제어용 제어 정보
프로토콜 스택은 내부에 메모리 영역을 가지고 제어 정보를 기록합니다   
제어 정보에는 통신 상대의 IP 주소, 포트 번호, 통신 동작의 진행 상태 등이 있다   
프로토콜 스택은 소켓에 기록된 제어 정보를 참조하면서 움직인다

    3. Socket을 호출했을 때의 동작
애플리케이션이 socket을 호출하면 프로토콜 스택은 메모리 영역을 확보해 소켓을 만든다.   
아직 초기 상태라는 것을 이 영역에 기록한다.   
소켓을 만든 후 소켓을 나타내는 디스크립터를 애플리케이션에 알려준다.

## 2 서버에 접속한다
    1. 접속의 의미
소켓은 만든 직후 애플리케이션은 connect를 호출. 접속 동작 시작   
접속 동작은 우선 통신 상대와 제어 정보(IP 주소, 포트 번호 등)를 주고 받는 것으로 시작함.    
데이터 송수신 동작에서 송수신하는 데이터를 일시적으로 저장하는 메모리 영역을 '버퍼 메모리'라고 함.   
접속 동작을 할 때 버퍼 메모리를 확보함.

    2. 맨 앞부분에 제어 정보를 기록한 헤더를 배치한다
제어 정보에는 1) 클라이언트와 서버가 서로 연락하기 위해 주고 받는 제어 정보와   
2) 소켓에 기록하여 프로토콜 스택의 동작을 제어하는 제어 정보가 있다.   
   
1)은 통신 동작 전체에서 필요한 정보, 클라이언트와 서버 사이 주고 받는 패킷의 맨 앞부분에 부가함.   
이것을 _**헤더**_ 라고 부름. TCP 헤더, 이더넷 헤더, IP 헤더 등 무엇의 헤더인지를 써야 함.   
클라이언트와 서버는 헤더에 필요한 정보를 기록, 연락하며 통신 동작을 진행함.   
데이터를 저장한 패킷의 맨 앞부분이 헤더.   
제어 동작이나 연결 끊기 동작 등 데이터가 없는 경우 제어 정보만 주고 받음. 즉 헤더만 주고 받음.   
   
2)에는 앱에서 통지된 정보, 통신 상대로부터 받은 정보, 진행 상황 등이 수시로 기록.  
프로토콜 스택이 하나하나 정보를 참조하면서 움직이므로 소켓의 제어 정보는 프로토콜 스택의 프로그램과 일체화 되어 있다 해도 무방.   
클라이언트와 서버는 헤더의 제어 정보 만으로 연락이 가능하므로 소켓에 기록한 제어 정보는 상대측에서 볼 수 없음.   
OS가 다르면 프로토콜 스택 만드는 방법이 달라 제어 정보도 다르지만 통신하는데는 문제가 없는 것.   

    3. 접속 동작의 실제
송신처와 수신처의 포트 번호를 통해 송신처와 수신처의 소켓을 지정할 수 있음.   
지정했으면 컨트롤 비트인 SYN 라는 비트를 1로 만듦.   
   
connect를 호출하면 제어 정보가 프로토콜 스택 TCP 부분 -> IP 부분 -> 네트워크 (패킷 형태로 이동) ->   
서버 측 IP 담당 부분 -> 서버 TCP 부분에 제어 정보 도착하면 TCP 헤더를 조사, 포트 번호에 해당하는 소켓을 발견 ->   
여기에 필요한 정보를 기록, 접속 동작을 진행 중 상태로 바꾸고 다시 응답을 클라이언트로 반송   
   
서버도 송신처와 수신처의 포트 번호, SYN 비트 등을 설정한 TCP 헤더를 만들고, _**ACK**_ 라는 컨트롤 비트도 1로 만듦.   
ACK를 1로 만드는 것은 패킷을 받은 것을 알리기 위한 동작. TCP  헤더를 IP 담당 부분에게 건네주어 클라이언트에 전송   
   
패킷이 IP 부분을 경유해 TCP 부분 도착. TCP 헤더 조사.   
SYN이 1이면 접속 성공이므로 소켓에 서버의 IP 주소나 포트 번호 등과 접속 완료를 나타내는 제어 정보를 소켓에 기록.   
패킷 무사 도착을 서버에 알리기 위해 ACK를 1로 만든 TCP 헤더를 서버에 반송. 서버에 도착하면 접속 동작의 대화 끝.  
   
이제 소켓은 데이터를 송수신할 수 있는 상태. chapter1에서의 파이프 연결 비유가 이 상태인 것.   
이 상태를 커넥션 혹은 세션이라고 함. 세션이 만료되었습니다 할 때의 그 세션인 것 같음.   
close를 호출해 연결을 끊을 때까지 계속 존재함.

## 3 데이터를 송수신한다
    1. 프로토콜 스택에 HTTP 리퀘스트 메시지를 넘긴다
가나다 

    2. 데이터가 클 때는 분할하여 보낸다
가나다 

    3. ACK 번호를 사용하여 패킷이 도착했는지 확인한다
가나다 

    4. 패킷 평균 왕복 시간으로 ACK 번호의 대기 시간을 조정한다
간다ㅏ 

    5. 윈도우 제어 방식으로 효율적으로 ACK 번호를 관리한다
가나다

    6. ACK 번호와 윈도우를 합승한다
간다ㅏ 

    7. HTTP 응답 메시지를 수신한다
가나다


## 4 서버에서 연결을 끊어 소켓을 말소한다

## 5 IP와 이더넷의 패킷 송수신 동작

## 6 UDP 프로토콜을 이용한 송수신 동작
